tasks:
  - name: Setup dependencies and run app
    init: |
      poetry export -f requirements.txt --output requirements.gitpod --without-hashes
      echo 'CSRF_TRUSTED_ORIGINS = ["https://*.gitpod.io"]' >> tests/testapp/gitpod_settings.py
    command: |
      pip install -U pip
      pip install -r requirements.gitpod
      python manage.py migrate
      python testmanage.py runserver 0.0.0.0:8000

ports:
  - port: 8000
    onOpen: open-preview
    name: Demo
    description: Preview
